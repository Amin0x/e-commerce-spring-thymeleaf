<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>User Dashboard</title>
    <link href="../../../static/public/css/all.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link th:href="@{/admin/main.css}" href="../../../static/admin/main.css" rel="stylesheet">
</head>
<body>
    <div class="wrapper">
        <aside th:replace="~{admin/fragments/navigation :: navigation}"></aside>
        <main class="content">
            <header th:replace="~{admin/fragments/header :: header}"></header>
            <div class="user-index-container" style="padding: 0 30px; margin-top: 30px;">
                <h1 class="page-title" style="margin-bottom: 16px;">Users home</h1>
                <div class="users-counters">
                        <div class="counter-card">
                            <div class="card">
                                <div class="title"><span>Total Users</span></div>
                                <div class="body">
                                    <h5 th:text="${totalUsers}"></h5>
                                </div>
                            </div>
                        </div>
                        <div class="counter-card">
                            <div class="card">
                                <div class="title">Active Users</div>
                                <div class="body">
                                    <h5 th:text="${activeUsers}"></h5>
                                </div>
                            </div>
                        </div>
                        <div class="counter-card">
                            <div class="card">
                                <div class="title">New Users</div>
                                <div class="body">
                                    <h5 th:text="${newUsers}"></h5>
                                </div>
                                <div>this month</div>
                            </div>
                        </div>
                        <div class="counter-card">
                            <div class="card">
                                <div class="title">Inactive Users</div>
                                <div class="body">
                                    <h5 th:text="${inactiveUsers}"></h5>
                                </div>
                            </div>
                        </div>
                    </div>
                <div class="container-user-chart mb-4">
                    <div class="chart-users-reg box-round">
                        <div style="margin-bottom: 8px; display: flex; gap: 16px; justify-content: space-between;">
                            <div class="title"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-plus" viewBox="0 0 16 16">
                                <path d="M6 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6m2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0m4 8c0 1-1 1-1 1H1s-1 0-1-1 1-4 6-4 6 3 6 4m-1-.004c-.001-.246-.154-.986-.832-1.664C9.516 10.68 8.289 10 6 10s-3.516.68-4.168 1.332c-.678.678-.83 1.418-.832 1.664z"/>
                                <path fill-rule="evenodd" d="M13.5 5a.5.5 0 0 1 .5.5V7h1.5a.5.5 0 0 1 0 1H14v1.5a.5.5 0 0 1-1 0V8h-1.5a.5.5 0 0 1 0-1H13V5.5a.5.5 0 0 1 .5-.5"/>
                            </svg> <span>User Registration</span></div>
                        </div>
                        <canvas id="usersRegistrationChart"></canvas>
                    </div>
                    <div class="chart-users-reg box-round">
                        <div style="margin-bottom: 8px; display: flex; gap: 16px; justify-content: space-between;">
                            <div class="title"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-check" viewBox="0 0 16 16">
                                <path d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7m1.679-4.493-1.335 2.226a.75.75 0 0 1-1.174.144l-.774-.773a.5.5 0 0 1 .708-.708l.547.548 1.17-1.951a.5.5 0 1 1 .858.514M11 5a3 3 0 1 1-6 0 3 3 0 0 1 6 0M8 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4"/>
                                <path d="M8.256 14a4.5 4.5 0 0 1-.229-1.004H3c.001-.246.154-.986.832-1.664C4.484 10.68 5.711 10 8 10q.39 0 .74.025c.226-.341.496-.65.804-.918Q8.844 9.002 8 9c-5 0-6 3-6 4s1 1 1 1z"/>
                            </svg><span>User Visits</span></div>
                        </div>
                        <canvas id="driversRegistrationChart"></canvas>
                    </div>
                </div>
                <section class="top-users box-round">
                    <div style="margin-bottom: 8px; display: flex; gap: 16px; justify-content: space-between;">
                        <div class="card-title"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-stickies" viewBox="0 0 16 16">
                            <path d="M1.5 0A1.5 1.5 0 0 0 0 1.5V13a1 1 0 0 0 1 1V1.5a.5.5 0 0 1 .5-.5H14a1 1 0 0 0-1-1z"/>
                            <path d="M3.5 2A1.5 1.5 0 0 0 2 3.5v11A1.5 1.5 0 0 0 3.5 16h6.086a1.5 1.5 0 0 0 1.06-.44l4.915-4.914A1.5 1.5 0 0 0 16 9.586V3.5A1.5 1.5 0 0 0 14.5 2zM3 3.5a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 .5.5V9h-4.5A1.5 1.5 0 0 0 9 10.5V15H3.5a.5.5 0 0 1-.5-.5zm7 11.293V10.5a.5.5 0 0 1 .5-.5h4.293z"/>
                        </svg> <span>New Users This Month</span></div>
                        <div><a href="#">View All</a></div>
                    </div>
                    <div th:if="${#lists.isEmpty(newUsersList) != true}">
                        <table class="table table-bordered"  style="">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>User ID</th>
                                    <th>Email</th>
                                    <th>Registration Date</th>
                                    <th>Update Date</th>
                                    <th>Active Date</th>
                                    <th>Role</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="user : ${newUsersList}">
                                    <td><a th:href="${'/admin/users/' + user.id }"
                                           th:text="${user.firstName} + ' ' + ${user.lastName}"></a></td>
                                    <td th:text="${user.username}"></td>
                                    <td th:text="${user.email}"></td>
                                    <td th:text="${#temporals.format(user.created, 'yyyy-MM-dd')}"></td>
                                    <td th:text="${#temporals.format(user.updated, 'yyyy-MM-dd')}"></td>
                                    <td th:text="${#temporals.format(user.lastActive, 'yyyy-MM-dd')}"></td>
                                    <td th:text="${user.role}"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div th:unless="${#lists.isEmpty(newUsersList)} != true"></div>
                </section>
            </div>
        </main>
    </div>



    <!-- Bootstrap 5 JS (Optional, for additional functionality like dropdowns, etc.) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script th:inline="javascript">
        // Users Registration Chart (Monthly)
        var ctx1 = document.getElementById('usersRegistrationChart').getContext('2d');
        var usersRegistrationChart = new Chart(ctx1, {
            type: 'line',
            data: {
                labels: [[${ usersRegistrationLabels }]], // Dynamic labels (months)
                datasets: [{
                    label: 'Users Registration',
                    data: [[${ usersRegistrationData }]], // Dynamic data (user counts)
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 2,
                    fill: false
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        // Drivers Registration Chart (Monthly)
        var ctx2 = document.getElementById('driversRegistrationChart').getContext('2d');
        var driversRegistrationChart = new Chart(ctx2, {
            type: 'line',
            data: {
                labels: [[${ driversRegistrationLabels }]], // Dynamic labels (months)
                datasets: [{
                    label: 'Drivers Registration',
                    data: [[${ driversRegistrationData }]], // Dynamic data (driver counts)
                    borderColor: 'rgba(255, 159, 64, 1)',
                    borderWidth: 2,
                    fill: false
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    </script>
</body>
</html>